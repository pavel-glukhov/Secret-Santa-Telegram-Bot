## Secret Santa Telegram Bot
[![en](https://img.shields.io/badge/lang-en-green.svg)](https://github.com/pavel-glukhov/Secret-Santa-Telegram-Bot/blob/main/README.md)
[![ru](https://img.shields.io/badge/lang-ru-yelow.svg)](https://github.com/pavel-glukhov/Secret-Santa-Telegram-Bot/blob/main/README.ru.md)

## –û–ø–∏—Å–∞–Ω–∏–µ
–ë–æ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã Secret Santa –≤ Telegram. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ª–µ–≥–∫–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∂–µ—Ä–µ–±—å–µ–≤–∫—É, –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∏ –µ–≥–æ –°–µ–∫—Ä–µ—Ç–Ω—ã–º –°–∞–Ω—Ç–∞.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:
- RU
- ENG
- KAZ
- UK

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 0.4.2

---
## Changelog

**v 0.4.2**
* –õ–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ runtime.
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ä–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞:
    - Polling ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    - Webhook ‚Äî –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å HTTPS.

**v 0.4.1**
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ –ø–æ URL.
* –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∏–∞–ª–æ–≥–∏.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**v 0.4.0**
* –í—Å–µ ORM-–∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –Ω–∞ async.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

**v 0.3.0**
* –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∂–µ—Ä–µ–±—å–µ–≤–∫–∏.
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏.

**v 0.2.2**
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã SQL-–∑–∞–ø—Ä–æ—Å—ã.

**v 0.2.1**
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –ø–æ–∂–µ–ª–∞–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤.
* –û–±–Ω–æ–≤–ª–µ–Ω—ã —è–∑—ã–∫–æ–≤—ã–µ —Å–ª–æ–≤–∞—Ä–∏.

**v 0.2.0**
* –ú–∏–≥—Ä–∞—Ü–∏—è —Å Aiogram 2 –Ω–∞ Aiogram 3.
* SQLAlchemy –∑–∞–º–µ–Ω–∏–ª Tortoise ORM.
* –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤.

**v 0.1.0**
* Beta —Ä–µ–ª–∏–∑.

---

–î–∏–∞–≥—Ä–∞–º–º–∞: https://miro.com/app/board/uXjVNxWmMtE=/?share_link_id=603886678614

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Aiogram 3
- FastAPI
- SQLAlchemy 2
- Alembic
- PostgreSQL
- Redis

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç

- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –¥–ª—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
    - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å:
        - **–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã**
        - **–ë—é–¥–∂–µ—Ç**
        - **–ü–æ–∂–µ–ª–∞–Ω–∏—è –∫ –ø–æ–¥–∞—Ä–∫—É**

```
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è USER_ROOMS_LIMIT –∑–∞–¥–∞—ë—Ç –ª–∏–º–∏—Ç –∫–æ–º–Ω–∞—Ç, –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
```

```
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, –µ–≥–æ –¥–ª–∏–Ω–∞ –∑–∞–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ROOM_NUMBER_LENGTH.
```

### 2. –í—Ö–æ–¥ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–º–Ω–∞—Ç—É –ø–æ ID

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º

- –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–≤–æ–¥–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å:
    - **–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—é**
    - **–î–æ–º–∞—à–Ω–∏–π –∞–¥—Ä–µ—Å**
    - **–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
    - **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å**
    - **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**
    - **–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**

```
–ê–¥—Ä–µ—Å –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —à–∏—Ñ—Ä—É—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Fernet.
```

### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–æ–π

- –ú–µ–Ω—é –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
    - **–ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É**
    - **–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è**
- –ú–µ–Ω—é –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–º–Ω–∞—Ç—ã:
    - **–ù–∞—á–∞—Ç—å –∏–≥—Ä—É** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        - **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞**
    - **–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è**
    - **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
        - **–£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É**
        - **–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã**
        - **–°–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞**
        - **–ò–∑–º–µ–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç**

```
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –ø–æ–∫–∏–Ω—É—Ç—å –µ—ë, –ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ö–æ–º–Ω–∞—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é.
```

```
–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –∂–µ—Ä–µ–±—å—ë–≤–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–∫–æ–≤, –∫–æ–º–Ω–∞—Ç—É –º–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ.
```

### 5. –û–±—â–µ–Ω–∏–µ

–ü–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –æ–±—â–µ–Ω–∏—è:

- **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¢–∞–π–Ω–æ–º—É –°–∞–Ω—Ç–µ**
- **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é –ø–æ–¥–∞—Ä–∫–∞**

---

## –†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:

### üîπ Polling (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ / —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –±–æ—Ç–æ–≤
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç HTTPS
```bash
python -m app.runtimes.polling
```
- –ß–µ—Ä–µ–∑ Docker:
```bash
docker-compose -f docker-compose_long_polling.yaml up
```

### üîπ Webhook (production)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π HTTPS
```bash
uvicorn app.runtimes.webhook:create_app
```
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –†—É—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
```bash
python .\manage.py register_webhook
```
- –ò–ª–∏ —á–µ—Ä–µ–∑ GET-–∑–∞–ø—Ä–æ—Å:
```bash
https://api.telegram.org/bot{telegram_token}/setWebhook?url=https://{domain_name}/bot/
```

### üîß Docker
| –†–µ–∂–∏–º | –ö–æ–º–∞–Ω–¥–∞                                                 |
|-------|---------------------------------------------------------|
| Polling | `docker-compose -f docker-compose_long_polling.yaml up` |
| Webhook | `docker-compose up`                                     |

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–ø—É—Å–∫—É

1. –°–æ–∑–¥–∞—Ç—å `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`.
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:
```bash
python .\manage.py generate_key
```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```
4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
alembic upgrade head
```

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ß–µ—Ä–µ–∑ Docker:
```bash
docker exec -t <container_name> pg_dump -U <username> <database_name> > <file_name>.sql
```
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ `deploy/backup`.

---

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –í—ã–¥–∞—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
python .\manage.py set_superuser <telegram_user_id>
```
- –£–±—Ä–∞—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
python .\manage.py remove_superuser <telegram_user_id>
```

