## Secret Santa Telegram Bot
[![en](https://img.shields.io/badge/lang-en-green.svg)](https://github.com/pavel-glukhov/Secret-Santa-Telegram-Bot/blob/main/README.md)
[![ru](https://img.shields.io/badge/lang-ru-yelow.svg)](https://github.com/pavel-glukhov/Secret-Santa-Telegram-Bot/blob/main/README.ru.md)

## –û–ø–∏—Å–∞–Ω–∏–µ
–ë–æ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã Secret Santa –≤ Telegram. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ª–µ–≥–∫–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∂–µ—Ä–µ–±—å–µ–≤–∫—É, –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∏ –µ–≥–æ –°–µ–∫—Ä–µ—Ç–Ω—ã–º –°–∞–Ω—Ç–∞.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:
- RU
- ENG
- KAZ
- UK

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 0.4.2

---
## Changelog

**v 0.4.2**
* –õ–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ runtime.
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ä–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞:
    - Polling ‚Äî –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
    - Webhook ‚Äî –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å HTTPS.

**v 0.4.1**
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ –ø–æ URL.
* –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∏–∞–ª–æ–≥–∏.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**v 0.4.0**
* –í—Å–µ ORM-–∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –Ω–∞ async.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

**v 0.3.0**
* –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∂–µ—Ä–µ–±—å–µ–≤–∫–∏.
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏.

**v 0.2.2**
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã SQL-–∑–∞–ø—Ä–æ—Å—ã.

**v 0.2.1**
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –ø–æ–∂–µ–ª–∞–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤.
* –û–±–Ω–æ–≤–ª–µ–Ω—ã —è–∑—ã–∫–æ–≤—ã–µ —Å–ª–æ–≤–∞—Ä–∏.

**v 0.2.0**
* –ú–∏–≥—Ä–∞—Ü–∏—è —Å Aiogram 2 –Ω–∞ Aiogram 3.
* SQLAlchemy –∑–∞–º–µ–Ω–∏–ª Tortoise ORM.
* –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤.

**v 0.1.0**
* Beta —Ä–µ–ª–∏–∑.

---

–î–∏–∞–≥—Ä–∞–º–º–∞: https://miro.com/app/board/uXjVNxWmMtE=/?share_link_id=603886678614

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Aiogram 3
- FastAPI
- SQLAlchemy 2
- Alembic
- PostgreSQL
- Redis

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç

- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –¥–ª—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
    - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å:
        - **–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã**
        - **–ë—é–¥–∂–µ—Ç**
        - **–ü–æ–∂–µ–ª–∞–Ω–∏—è –∫ –ø–æ–¥–∞—Ä–∫—É**

```
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è USER_ROOMS_LIMIT –∑–∞–¥–∞—ë—Ç –ª–∏–º–∏—Ç –∫–æ–º–Ω–∞—Ç, –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
```

```
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, –µ–≥–æ –¥–ª–∏–Ω–∞ –∑–∞–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ROOM_NUMBER_LENGTH.
```

### 2. –í—Ö–æ–¥ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–º–Ω–∞—Ç—É –ø–æ ID

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º

- –ë–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–≤–æ–¥–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å:
    - **–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—é**
    - **–î–æ–º–∞—à–Ω–∏–π –∞–¥—Ä–µ—Å**
    - **–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
    - **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å**
    - **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**
    - **–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**

```
–ê–¥—Ä–µ—Å –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —à–∏—Ñ—Ä—É—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Fernet.
```

### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–æ–π

- –ú–µ–Ω—é –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
    - **–ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É**
    - **–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è**
- –ú–µ–Ω—é –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–º–Ω–∞—Ç—ã:
    - **–ù–∞—á–∞—Ç—å –∏–≥—Ä—É** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        - **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞**
    - **–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è**
    - **–°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**
    - **–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞**
    - **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
        - **–£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É**
        - **–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã**
        - **–°–º–µ–Ω–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞**
        - **–ò–∑–º–µ–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç**

```
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –ø–æ–∫–∏–Ω—É—Ç—å –µ—ë, –ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ö–æ–º–Ω–∞—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é.
```

```
–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –∂–µ—Ä–µ–±—å—ë–≤–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–∫–æ–≤, –∫–æ–º–Ω–∞—Ç—É –º–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ.
```

### 5. –û–±—â–µ–Ω–∏–µ

–ü–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –æ–±—â–µ–Ω–∏—è:

- **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¢–∞–π–Ω–æ–º—É –°–∞–Ω—Ç–µ**
- **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é –ø–æ–¥–∞—Ä–∫–∞**

---

## –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
–°–æ–∑–¥–∞–π—Ç–µ `.env` —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–º–µ—Ä—É `.env.example`.

## Environment Variables
| Category | Variable | Description | Default Value | Notes |
|--------|----------|-------------|---------------|---|
| **Security** | `ENCRYPT_SECRET_KEY` | Base64-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π 32-–±–∞–π—Ç–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö | ‚ùå *–Ω–µ—Ç* | –û–±—è–∑–∞—Ç–µ–ª–µ–Ω. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: `python manage.py generate_key` |
| **Telegram Bot** | `TELEGRAM_TOKEN` | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ –æ—Ç @BotFather | ‚ùå *–Ω–µ—Ç* | –û–±—è–∑–∞—Ç–µ–ª–µ–Ω |
|  | `TELEGRAM_LOGIN` | Username –±–æ—Ç–∞ –±–µ–∑ `@` | ‚ùå *–Ω–µ—Ç* | –ü—Ä–∏–º–µ—Ä: `my_bot_name` |
|  | `SUPPORT_ACCOUNT` | –ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (Telegram) | ‚ùå *–Ω–µ—Ç* | –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ About |
| **Room Configuration** | `ROOM_NUMBER_LENGTH` | –î–ª–∏–Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ ID –∫–æ–º–Ω–∞—Ç—ã | `6` | –î–æ–ø—É—Å—Ç–∏–º–æ: `5‚Äì8` |
|  | `USER_ROOMS_LIMIT` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∫–æ–º–Ω–∞—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `3` | |
| **Database (PostgreSQL)** | `DATABASE_NAME` | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | ‚ùå *–Ω–µ—Ç* | |
|  | `DATABASE_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î | ‚ùå *–Ω–µ—Ç* ||
|  | `DATABASE_PASSWORD` | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î | ‚ùå *–Ω–µ—Ç* | ‚ö†Ô∏è —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç–µ |
|  | `DATABASE_HOST` | –•–æ—Å—Ç –ë–î | `db` | `db` ‚Äî Docker, `localhost` ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ |
|  | `DATABASE_PORT` | –ü–æ—Ä—Ç PostgreSQL | `5432` ||
|  | `POOL_SIZE` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ | `5` | |
|  | `MAX_OVERFLOW` | –ú–∞–∫—Å. –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å–≤–µ—Ä—Ö –ø—É–ª–∞ | `10` | |
| **Redis** | `REDIS_HOST` | –•–æ—Å—Ç Redis | `redis` | `redis` ‚Äî Docker, `localhost` ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ |
|  | `REDIS_PORT` | –ü–æ—Ä—Ç Redis | `6379` ||
|  | `REDIS_DB` | –ù–æ–º–µ—Ä –±–∞–∑—ã Redis | `0` | |
|  | `REDIS_PASSWORD` | –ü–∞—Ä–æ–ª—å Redis | *(–ø—É—Å—Ç–æ)* | –ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| **Webhook & SSL (Certbot)** | `DOMAIN_NAME` | –î–æ–º–µ–Ω –¥–ª—è webhook (–±–µ–∑ http/https) | ‚ùå *–Ω–µ—Ç* | –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è webhook |
|  | `EMAIL` | Email –¥–ª—è Certbot | ‚ùå *–Ω–µ—Ç* | –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è webhook |
| **System** | `SERVER_TIMEZONE` | –¢–∞–π–º–∑–æ–Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞ | `Asia/Almaty` ||


### –†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã. –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –Ω–∞–ª–∏—á–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ HTTPS-–¥–æ–º–µ–Ω–∞.

---

## üîÅ Polling Mode (Long Polling)

**–û–ø–∏—Å–∞–Ω–∏–µ**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è long polling Telegram API
- **–ù–µ —Ç—Ä–µ–±—É–µ—Ç** –ø—É–±–ª–∏—á–Ω–æ–≥–æ HTTPS
- –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
  - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  - –±–æ—Ç–æ–≤ —Å –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
  - —Å–µ—Ä–≤–µ—Ä–æ–≤ –±–µ–∑ –¥–æ–º–µ–Ω–∞

**–ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ**
```bash
python -m app.runtimes.polling
```

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker**
```bash
docker-compose -f docker-compose_long_polling.yaml up
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**
- Telegram —Å–∞–º –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–æ—Ç–∞
- –ß—É—Ç—å –±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å webhook
- –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä polling**

---

## üåê Webhook Mode

**–û–ø–∏—Å–∞–Ω–∏–µ**
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Telegram webhooks
- –¢—Ä–µ–±—É–µ—Ç—Å—è **–ø—É–±–ª–∏—á–Ω—ã–π HTTPS endpoint**
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –ú–µ–Ω—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∏ –ª—É—á—à–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

---

## –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Webhook

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhook –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É–Ω–Ω–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ngrok`).

```bash
uvicorn app.runtimes.webhook:create_app --reload
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–±—Ä–æ—Å—å—Ç–µ –ø–æ—Ä—Ç –Ω–∞—Ä—É–∂—É –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ webhook –Ω–∞ –≤—ã–¥–∞–Ω–Ω—ã–π HTTPS-URL.

---

## –ü—Ä–æ–¥–∞–∫—à–µ–Ω (Webhook)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ–º–µ–Ω
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã **80** –∏ **443**
- –í–∞–ª–∏–¥–Ω—ã–π HTTPS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –ó–∞–ø—É—Å–∫
```bash
uvicorn app.runtimes.webhook:create_app
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Webhook

Webhook –º–æ–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**  
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ß–µ—Ä–µ–∑ management-–∫–æ–º–∞–Ω–¥—É**
```bash
python manage.py register_webhook
```

**–í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Telegram API**
```text
https://api.telegram.org/bot{telegram_token}/setWebhook?url=https://{domain_name}/bot/
```

---

## HTTPS –∏ Caddy

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ webhook —Ä–∞–±–æ—Ç–∞–µ—Ç **—á–µ—Ä–µ–∑ Caddy**.

- Reverse proxy
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL (Let‚Äôs Encrypt)
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ HTTPS-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ backend

–ü–æ—Ç–æ–∫ —Ç—Ä–∞—Ñ–∏–∫–∞:

```
Telegram ‚Üí HTTPS ‚Üí Caddy ‚Üí backend
```

---

## üê≥ Docker-—Ä–µ–∂–∏–º—ã

| –†–µ–∂–∏–º           | –ö–æ–º–∞–Ω–¥–∞ |
|-----------------|---------|
| Polling         | `docker-compose -f docker-compose_long_polling.yaml up` |
| Webhook (Caddy) | `docker-compose up` |
| Webhook (Nginx) | `chmod +x nginx-entrypoint.sh`<br/>`docker-compose up -f docker-compose_nginx.yaml up`|
---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Engine

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –≤–∞—à–µ–π –û–°:

üëâ https://docs.docker.com/engine/install/

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
docker --version
docker compose version
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker daemon –∑–∞–ø—É—â–µ–Ω.

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
docker exec -t <container_name> pg_dump -U <username> <database_name> > <file_name>.sql
```

### –°–∫—Ä–∏–ø—Ç—ã –±—ç–∫–∞–ø–∞

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ:
```
deploy/backup
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –∑–∞–ø—É—Å–∫–∞—Ç—å –±—ç–∫–∞–ø—ã –ø–æ cron
- —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–ø–∏–∏ –≤–Ω–µ VPS

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

### –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
python manage.py set_superuser <telegram_user_id>
```

### –£–¥–∞–ª–∏—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
python manage.py remove_superuser <telegram_user_id>
```
